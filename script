#!/bin/bash

# Change this to your GitHub username
USERNAME="blariise"

repos=("recipes" "memory-game" "cv-app" "battleship" "git-learn" "dsa" "weather" "todolist" "restaurant-page" "library" "tictactoe" "admin-dashboard" "css-exercises" "signup-form" "calculator" "javascript-exercises" "etch-a-sketch" "rock-paper-scissors" "landing-page")

# Ensure the working directory is clean before starting
if ! git diff-index --quiet HEAD --; then
    echo "‚ùå Error: You have uncommitted changes. Please commit or stash them first."
    exit 1
fi

for repo in "${repos[@]}"
do
    echo "------------------------------------------------"
    echo "üì¶ Processing: $repo"
    
    REMOTE_URL="git@github.com:$USERNAME/$repo.git"
    REMOTE_NAME="temp-$repo"

    # Add and fetch
    git remote add $REMOTE_NAME $REMOTE_URL
    git fetch $REMOTE_NAME --quiet

    # Determine if the remote branch is main or master
    if git rev-parse --verify $REMOTE_NAME/main >/dev/null 2>&1; then
        BRANCH="main"
    elif git rev-parse --verify $REMOTE_NAME/master >/dev/null 2>&1; then
        BRANCH="master"
    else
        echo "‚ö†Ô∏è Could not find main or master for $repo. skipping..."
        git remote remove $REMOTE_NAME
        continue
    fi

    echo "Merging $BRANCH branch from $repo..."
    
    # The actual subtree command
    if git subtree add --prefix=$repo $REMOTE_NAME $BRANCH; then
        echo "‚úÖ Successfully added $repo"
    else
        echo "‚ùå Subtree add failed for $repo"
    fi

    # Cleanup remote
    git remote remove $REMOTE_NAME
done

echo "------------------------------------------------"
echo "‚ú® Process complete!"
